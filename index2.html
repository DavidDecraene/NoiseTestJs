<!DOCTYPE html>
<html>
<head>
  <title>NoiseTest</title>
  <link rel="stylesheet"  type="text/css"  href="css/main.css">
  <script
  src="https://code.jquery.com/jquery-3.3.1.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous"></script>
  <script type="text/javascript" src="./js/simplex-noise.js"></script>
  <script type="text/javascript" src="./js/noise.samplers.js"></script>
  <script type="text/javascript" src="js/tinycolor.js"></script>
  <script type="text/javascript" src="./js/array2d.js"></script>
  <script type="text/javascript" src="./js/canvas.js"></script>
  <script type="text/javascript" src="./js/main.js"></script>
  <script type="text/javascript">

  function linearGradient(w, h) {
    return new Array2D().forEach(w, h, (x, y, a) => {
      const delta = y / h;
      a.setData(x, y, {
        noise: delta, color: tinycolor.fromRatio({
        r: delta, g: delta, b: delta
      }).toHexString()});
    });
  }

  function radialGradient(w, h, dx, dy) {
    const radius = Math.min(w, h) / 2;
    if (!dx ) dx = 0;
    if (!dy ) dy = 0;
    const center = new Vector2(w/2 + dx, h/2 + dy);
    // distance to center?
    return new Array2D().forEach(w, h, (x, y, a) => {
      const dist = center.distance(new Vector2(x, y));

      let delta = dist/radius;
      if (delta > 1) delta = 1;
      const noise = 1 - delta;
      a.setData(x, y, { noise, color: tinycolor.fromRatio({
        r: noise, g: noise, b: noise
      }).toHexString()});
    });
  }

  $(document).ready(function() {
    const $canvas1 = $('#canvas1');
    let w = 64;
    let h = 64;
    const freq  = 1 / 20;
    let mz = 0, uz = 0;
    const simplex = new SimplexSampler('test');
    const simplex2 = new SimplexSampler('second');
    const simplex3 = new SimplexSampler('third');
    const fbm = new FBMSampler(simplex);
    const fbm2 = new FBMSampler(simplex2);
    const fbm3 = new FBMSampler(simplex3);
    let arr = new Array2D().forEach(w, h, (x, y, a) => {
      const noise = (fbm.getNoise(x* freq, y* freq) + 1)  / 2;
      const color = tinycolor.fromRatio({ r: noise, g: noise, b: noise });
      a.setData(x, y, { noise, color : color.toHexString() });
    });
    new Canvas(4, { element: $('#FBM'), w, h }).draw(arr.values);
    const radialArr = radialGradient(w, h);
    new Canvas(4, { element: $('#Radial'), w, h }).draw(radialArr.values);

    const height = new Array2D().forEach(w, h, (x, y, a) => {
      const s = radialArr.getData(x, y).noise * 2 + arr.getData(x, y).noise;
      const avg  = s/3;
      let color;
      /**if (avg < 0.25) {
        color = tinycolor('blue');
      } else if (avg > 0.8) {
        color = tinycolor.fromRatio({ r: avg/2, g: avg/2, b: avg })
      } else {
      */
        color = tinycolor.fromRatio({ r: avg, g: avg, b: avg });
      //}

      a.setData(x, y, { noise: avg, color : color.toHexString() });
    });
    new Canvas(4, { element: $('#AVG'), w, h }).draw(height.values);

    const  arrFBM2 = new Array2D().forEach(w, h, (x, y, a) => {
      const noise = (fbm2.getNoise(x* freq, y* freq) + 1)  / 2;
      const color = tinycolor.fromRatio({ r: noise, g: noise, b: noise });
      a.setData(x, y, { noise, color : color.toHexString() });
    });
    new Canvas(4, { element: $('#FBM2'), w, h }).draw(arrFBM2.values);

    const radialArr2 = radialGradient(w, h);
    new Canvas(4, { element: $('#Radial2'), w, h }).draw(radialArr2.values);
    const radialArr3 = radialGradient(w, h, 5, 5);
    new Canvas(4, { element: $('#Radial3'), w, h }).draw(radialArr3.values);
    const radialArr4 = new Array2D().forEach(w, h, (x, y, a) => {
       // const noise = (radialArr2.getData(x, y).noise - radialArr3.getData(x, y).noise );
       const noise = (radialArr2.getData(x, y).noise - radialArr3.getData(x, y).noise*2 + 1) / 2;
       const color = tinycolor.fromRatio({ r: noise, g: noise, b: noise });
       a.setData(x, y, { noise, color : color.toHexString() });
     });
     new Canvas(4, { element: $('#Radial4'), w, h }).draw(radialArr4.values);

     const moist = new Array2D().forEach(w, h, (x, y, a) => {
        const noise = (arrFBM2.getData(x, y).noise + radialArr4.getData(x, y).noise*2 ) / 3;
        const color = tinycolor.fromRatio({ r: noise, g: noise, b: noise });
        a.setData(x, y, { noise, color : color.toHexString() });
      });
      new Canvas(4, { element: $('#Moist'), w, h }).draw(moist.values);

    const linear = linearGradient(w, h);
    const  arrFBM3 = new Array2D().forEach(w, h, (x, y, a) => {
      const noise = (fbm3.getNoise(x* freq, y* freq) + 1)  / 2;
      const color = tinycolor.fromRatio({ r: noise, g: noise, b: noise });
      a.setData(x, y, { noise, color : color.toHexString() });
    });
    new Canvas(4, { element: $('#FBM3'), w, h }).draw(arrFBM3.values);
    new Canvas(4, { element: $('#Linear'), w, h }).draw(linear.values);

    const temp = new Array2D().forEach(w, h, (x, y, a) => {
       const noise = (arrFBM3.getData(x, y).noise + linear.getData(x, y).noise * 2) / 3;
       const color = tinycolor.fromRatio({ r: noise, g: noise, b: noise });
       a.setData(x, y, { noise, color : color.toHexString() });
     });
     new Canvas(4, { element: $('#Temp'), w, h }).draw(temp.values);
     const tempHeight = new Array2D().forEach(w, h, (x, y, a) => {
        const noise = (temp.getData(x, y).noise - height.getData(x, y).noise / 2) ;
        const color = tinycolor.fromRatio({ r: noise, g: noise, b: noise });
        a.setData(x, y, { noise, color : color.toHexString() });
      });
      new Canvas(4, { element: $('#TempHeight'), w, h }).draw(tempHeight.values);
      const heightcol = new Array2D().forEach(w, h, (x, y, a) => {
         const noise = height.getData(x, y).noise;
         let color;
         if (noise < 0.15) {
           color = tinycolor('darkblue')
         } else if (noise < 0.3) {
           color = tinycolor('blue')
         } else if (noise < 0.35) {
           color = tinycolor('yellow')
         } else if (noise < 0.5) {
           color = tinycolor('green')
         } else if (noise < 0.7) {
           color = tinycolor('darkgreen')
         } else if (noise < 0.8) {
           color = tinycolor('red')
         } else if (noise < 0.83) {
           color = tinycolor('darkred')
         } else {

           color = tinycolor.fromRatio({ r: noise, g: noise, b: noise });
         }
         a.setData(x, y, { noise, color : color.toHexString() });
       });
       new Canvas(4, { element: $('#HeightCol'), w, h }).draw(heightcol.values);
  });

  </script>
</head>
<body>
  <!-- https://timetocode.tumblr.com/post/93970694121/volcanic-map-generation-step-by-step -->
<div id="canvas1" class="flex-stage">
  <p>Elevation</p>
  <canvas id="FBM"></canvas>
  <p>+</p>
  <canvas id="Radial"></canvas>
  <p>=</p>
  <canvas id="AVG"></canvas>
</div>
<div id="canvas2" class="flex-stage">
  <p>Moist</p>
  <canvas id="FBM2"></canvas>
  <p>+</p>
  <canvas id="Radial2"></canvas>
  <canvas id="Radial3"></canvas>
  <canvas id="Radial4"></canvas>
  <canvas id="Moist"></canvas>
</div>
<div id="canvas3" class="flex-stage">
  <p>Temp</p>
  <canvas id="FBM3"></canvas>
  <p>+</p>
  <canvas id="Linear"></canvas>
  <canvas id="Temp"></canvas>
  <canvas id="TempHeight"></canvas>
</div>
<div id="canvas4" class="flex-stage">
  <p>Results</p>
  <canvas id="HeightCol"></canvas>
</div>

</body>
</html>
